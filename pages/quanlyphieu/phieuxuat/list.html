<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ez Stock</title>
  <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/128/9089/9089758.png">

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../../../plugins/fontawesome-free/css/all.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="../../../plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="../../../plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- JQVMap -->
  <link rel="stylesheet" href="../../../plugins/jqvmap/jqvmap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../../../dist/css/adminlte.min.css">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="../../../plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="../../../plugins/daterangepicker/daterangepicker.css">
  <!-- summernote -->
  <link rel="stylesheet" href="../../../plugins/summernote/summernote-bs4.min.css">
  <!-- bonus css-->
  <link rel="stylesheet" href="../../../dist/css/bonus_css.css">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body class="hold-transition sidebar-mini layout-fixed">
  <div class="wrapper">

    <!-- Preloader -->
    <div class="preloader flex-column justify-content-center align-items-center">
      <img class="animation__shake" src="https://cdn-icons-png.flaticon.com/128/9089/9089758.png" alt="AdminLTELogo"
        height="60" width="60">
    </div>

    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="../../../dashboard.html" class="nav-link">Dashboard</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link">Contact</a>
        </li>
      </ul>

      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto">
        <!-- Navbar Search -->
        <li class="nav-item">
          <a class="nav-link" data-widget="navbar-search" href="#" role="button">
            <i class="fas fa-search"></i>
          </a>
          <div class="navbar-search-block">
            <form class="form-inline">
              <div class="input-group input-group-sm">
                <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
                <div class="input-group-append">
                  <button class="btn btn-navbar" type="submit">
                    <i class="fas fa-search"></i>
                  </button>
                  <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </li>

        <!-- Messages Dropdown Menu -->
        <li class="nav-item dropdown">
          <a class="nav-link" data-toggle="dropdown" href="#">
            <i class="far fa-comments"></i>
            <span class="badge badge-danger navbar-badge">3</span>
          </a>
          <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
            <a href="#" class="dropdown-item">
              <!-- Message Start -->
              <div class="media">
                <img src="../../../dist/img/user1-128x128.jpg" alt="User Avatar" class="img-size-50 mr-3 img-circle">
                <div class="media-body">
                  <h3 class="dropdown-item-title">
                    Brad Diesel
                    <span class="float-right text-sm text-danger"><i class="fas fa-star"></i></span>
                  </h3>
                  <p class="text-sm">Call me whenever you can...</p>
                  <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                </div>
              </div>
              <!-- Message End -->
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
              <!-- Message Start -->
              <div class="media">
                <img src="../../../dist/img/user8-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                <div class="media-body">
                  <h3 class="dropdown-item-title">
                    John Pierce
                    <span class="float-right text-sm text-muted"><i class="fas fa-star"></i></span>
                  </h3>
                  <p class="text-sm">I got your message bro</p>
                  <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                </div>
              </div>
              <!-- Message End -->
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
              <!-- Message Start -->
              <div class="media">
                <img src="../../../dist/img/user3-128x128.jpg" alt="User Avatar" class="img-size-50 img-circle mr-3">
                <div class="media-body">
                  <h3 class="dropdown-item-title">
                    Nora Silvester
                    <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                  </h3>
                  <p class="text-sm">The subject goes here</p>
                  <p class="text-sm text-muted"><i class="far fa-clock mr-1"></i> 4 Hours Ago</p>
                </div>
              </div>
              <!-- Message End -->
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item dropdown-footer">See All Messages</a>
          </div>
        </li>
        <!-- Notifications Dropdown Menu -->
        <li class="nav-item dropdown">
          <a class="nav-link" data-toggle="dropdown" href="#">
            <i class="far fa-bell"></i>
            <span class="badge badge-warning navbar-badge">15</span>
          </a>
          <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
            <span class="dropdown-item dropdown-header">15 Notifications</span>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
              <i class="fas fa-envelope mr-2"></i> 4 new messages
              <span class="float-right text-muted text-sm">3 mins</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
              <i class="fas fa-users mr-2"></i> 8 friend requests
              <span class="float-right text-muted text-sm">12 hours</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item">
              <i class="fas fa-file mr-2"></i> 3 new reports
              <span class="float-right text-muted text-sm">2 days</span>
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item dropdown-footer">See All Notifications</a>
          </div>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="fullscreen" href="#" role="button">
            <i class="fas fa-expand-arrows-alt"></i>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
            <i class="fas fa-th-large"></i>
          </a>
        </li>
      </ul>
    </nav>
    <!-- /.navbar -->

    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="index3.html" class="brand-link">
        <img src="https://cdn-icons-png.flaticon.com/128/9089/9089758.png" alt="AdminLTE Logo"
          class="brand-image img-circle elevation-3" style="opacity: .8">
        <span class="brand-text font-weight-light">EZ Stock</span>
      </a>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Sidebar user panel (optional) -->
        <div class="user-panel mt-3 pb-3 mb-3 d-flex">
          <div class="image">
            <img src="../../../dist/img/user2-160x160.jpg" class="img-circle elevation-2" alt="User Image">
          </div>
          <div class="info">
            <a href="#" class="d-block">Alexander Pierce</a>
          </div>
        </div>

        <!-- SidebarSearch Form -->
        <div class="form-inline">
          <div class="input-group" data-widget="sidebar-search">
            <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
            <div class="input-group-append">
              <button class="btn btn-sidebar">
                <i class="fas fa-search fa-fw"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-warehouse"></i>
                <p>
                  Kho
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">

                <li class="nav-item menu-open">
                  <a href="#" class="nav-link active">
                    <i class="nav-icon fas fa-warehouse"></i>
                    <p>
                      Danh m·ª•c kho
                      <i class="right fas fa-angle-left"></i>
                    </p>
                  </a>
                  <ul class="nav nav-treeview">

                    <li class="nav-item">
                      <a href="../../quanlykho/danhmuckho/create.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Th√™m</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="../../quanlykho/danhmuckho/list.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Danh s√°ch</p>
                      </a>
                    </li>

                  </ul>
                </li>
                <li class="nav-item menu-open">
                  <a href="#" class="nav-link active">
                    <i class="nav-icon fas fa-warehouse"></i>
                    <p>
                      Danh s√°ch kho
                      <i class="right fas fa-angle-left"></i>
                    </p>
                  </a>
                  <ul class="nav nav-treeview">

                    <li class="nav-item">
                      <a href="../../quanlykho/danhsachkho/create.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Th√™m</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="../../quanlykho/danhsachkho/list.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Danh s√°ch</p>
                      </a>
                    </li>

                  </ul>
                </li>
                <li class="nav-item">
                  <a href="../../quanlykho/capnhattonkho.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng t·ªìn kho</p>
                  </a>
                </li>

              </ul>
            </li>
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-box"></i>
                <p>
                  Qu·∫£n l√Ω danh s√°ch h√†ng ho√°
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="../../quanlyhanghoa/create.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Th√™m h√†ng ho√°</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../quanlyhanghoa/list.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Danh s√°ch h√†ng ho√°</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-user"></i>
                <p>
                  Qu·∫£n l√Ω ng∆∞·ªùi d√πng
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="../../quanlynguoidung/create.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>T·∫°o t√†i kho·∫£n</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../quanlynguoidung/list.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Danh s√°ch t√†i kho·∫£n</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-user"></i>
                <p>
                  Qu·∫£n l√Ω nh√† cung c·∫•p
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="../../quanlynhacungcap/create.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>T·∫°o nh√† cung c·∫•p</p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="../../quanlynhacungcap/list.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Danh s√°ch nh√† cung c·∫•p</p>
                  </a>
                </li>
              </ul>
            </li>
            <li class="nav-item menu-open">
              <a href="#" class="nav-link active">
                <i class="nav-icon fas fa-ticket-alt"></i>
                <p>
                  Qu·∫£n l√Ω phi·∫øu
                  <i class="right fas fa-angle-left"></i>
                </p>
              </a>
              <ul class="nav nav-treeview">
                <li class="nav-item menu-open">
                  <a href="#" class="nav-link active">
                    <i class="nav-icon fas fa-ticket-alt"></i>
                    <p>
                      Qu·∫£n l√Ω phi·∫øu nh·∫≠p
                      <i class="right fas fa-angle-left"></i>
                    </p>
                  </a>
                  <ul class="nav nav-treeview">
                    <li class="nav-item">
                      <a href="../phieunhap/create.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>T·∫°o phi·∫øu</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="../phieunhap/list.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Danh s√°ch phi·∫øu</p>
                      </a>
                    </li>
                  </ul>
                </li>
                <li class="nav-item menu-open">
                  <a href="#" class="nav-link active">
                    <i class="nav-icon fas fa-ticket-alt"></i>
                    <p>
                      Qu·∫£n l√Ω phi·∫øu xu·∫•t
                      <i class="right fas fa-angle-left"></i>
                    </p>
                  </a>
                  <ul class="nav nav-treeview">
                    <li class="nav-item">
                      <a href="./create.html" class="nav-link">
                        <i class="far fa-circle nav-icon"></i>
                        <p>T·∫°o phi·∫øu</p>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a href="./list.html" class="nav-link active">
                        <i class="far fa-circle nav-icon"></i>
                        <p>Danh s√°ch phi·∫øu</p>
                      </a>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>

            <li class="nav-item menu-open">

              <ul class="nav nav-treeview">
                <li class="nav-item">
                  <a href="../../lichsugiaohang/lichsugiaohang.html" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>L·ªãch s·ª≠ giao h√†ng</p>
                  </a>
                </li>
                <!-- <li class="nav-item">
                <a href="./thong_tin_don_hang.html" class="nav-link active">
                  <i class="far fa-circle nav-icon"></i>
                  <p>Th√¥ng tin ƒë∆°n h√†ng</p>
                </a>
              </li> -->

              </ul>
            </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Qu·∫£n l√Ω phi·∫øu</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Qu·∫£n l√Ω phi·∫øu</li>
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <!-- Main content -->

      <section class="content">
        <div class="row mb-3 p-3">
          <div class="col-md-4">
            <label for="filterCustomer">Kh√°ch h√†ng:</label>
            <input type="text" id="filterCustomer" class="form-control" placeholder="T√™n kh√°ch h√†ng" oninput="filterOrders()">
          </div>
          <div class="col-md-4">
            <label for="filterStartDate">Ng√†y b·∫Øt ƒë·∫ßu:</label>
            <input type="date" id="filterStartDate" class="form-control" onchange="filterOrders()">
          </div>
          <div class="col-md-4">
            <label for="filterEndDate">Ng√†y k·∫øt th√∫c:</label>
            <input type="date" id="filterEndDate" class="form-control" onchange="filterOrders()">
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Phi·∫øu xu·∫•t</h3>
            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                <i class="fas fa-minus"></i>
              </button>
              <button type="button" class="btn btn-tool" data-card-widget="remove" title="Remove">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <table class="table table-striped phieu">
              <thead>
                <tr>
                  <th style="width: 5%">#</th>
                  <th style="width: 13%">Lo·∫°i phi·∫øu xu·∫•t</th> <!-- ƒê·ªïi t·ª´ "M√£ phi·∫øu xu·∫•t" th√†nh "Lo·∫°i phi·∫øu xu·∫•t" -->
                  <th style="width: 13%">Kh√°ch h√†ng</th>
                  <th style="width: 13%">Kho xu·∫•t</th>
                  <th style="width: 13%">Ng∆∞·ªùi xu·∫•t</th>
                  <th style="width: 13%">Ng√†y xu·∫•t</th>
                  <th style="width: 13%">T·ªïng ti·ªÅn</th>
                  <th></th>
                  <!-- <th class="text-center" style="width: 20%">Tr·∫°ng th√°i</th> -->
                </tr>
              </thead>
              <tbody id="orderList">
                <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- View Modal -->
        <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="viewModalLabel">Chi ti·∫øt phi·∫øu</h5>
              </div>
              <div class="modal-body">
                <p><strong>M√£ phi·∫øu xu·∫•t:</strong> <span id="viewMaPhieuXuat"></span></p>
                <p><strong>Nh√† cung c·∫•p:</strong> <span id="viewNhaCungCap"></span></p>
                <p><strong>Kho xu·∫•t:</strong> <span id="viewKhoXuat"></span></p>
                <p><strong>Ng∆∞·ªùi xu·∫•t:</strong> <span id="viewNguoiXuat"></span></p>
                <p><strong>Ng√†y xu·∫•t:</strong> <span id="viewNgayXuat"></span></p>
                <p><strong>T·ªïng ti·ªÅn:</strong> <span id="viewTongTien"></span></p>
                <p><strong>Tr·∫°ng th√°i:</strong> <span id="viewTrangThai"></span></p>

                <h5>Danh s√°ch s·∫£n ph·∫©m</h5>
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th>S·ªë l∆∞·ª£ng</th>
                      <th>ƒê∆°n gi√°</th>
                    </tr>
                  </thead>
                  <tbody id="viewDanhSachSanPham">
                    <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                  </tbody>
                </table>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                  onclick="closeModal('viewModal')">ƒê√≥ng</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit Modal -->
        <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Ch·ªânh s·ª≠a phi·∫øu xu·∫•t</h5>
              </div>
              <div class="modal-body">
                <!-- Lo·∫°i phi·∫øu xu·∫•t -->
                <label for="editOrderType" class="mt-2">Lo·∫°i phi·∫øu xu·∫•t:</label>
                <select id="editOrderType" class="form-control" onchange="handleEditExportTypeChange()">
                  <option value="1">Xu·∫•t n·ªôi b·ªô</option>
                  <option value="2">Xu·∫•t ngo√†i</option>
                </select>

                <!-- Kho xu·∫•t -->
                <div id="editWarehouseGroup" class="mt-2">
                  <label for="editKhoXuat">Kho xu·∫•t:</label>
                  <input type="text" id="editKhoXuat" class="form-control" placeholder="Ch·ªçn kho"
                    oninput="showEditWarehouseDropdown(this)" onfocus="showEditWarehouseDropdown(this, true)">
                  <div class="dropdown-menu" id="editWarehouseDropdown"></div>
                </div>

                <!-- Kh√°ch h√†ng (hi·ªÉn th·ªã cho xu·∫•t ngo√†i) -->
                <div id="editCustomerGroup" class="mt-2" style="display: none;">
                  <label for="editNhaCungCap">Kh√°ch h√†ng:</label>
                  <input type="text" id="editNhaCungCap" class="form-control">
                </div>

                <!-- ƒê·ªãa ch·ªâ (hi·ªÉn th·ªã cho xu·∫•t ngo√†i) -->
                <div id="editAddressGroup" class="mt-2" style="display: none;">
                  <label for="editAddress">ƒê·ªãa ch·ªâ:</label>
                  <input type="text" id="editAddress" class="form-control">
                </div>

                <!-- Ng∆∞·ªùi xu·∫•t -->
                <label for="editNguoiXuat" class="mt-2">Ng∆∞·ªùi xu·∫•t:</label>
                <input type="text" id="editNguoiXuat" class="form-control" readonly>

                <!-- Ng√†y xu·∫•t -->
                <label for="editNgayXuat" class="mt-2">Ng√†y xu·∫•t:</label>
                <input type="date" id="editNgayXuat" class="form-control">

                <!-- T·ªïng ti·ªÅn -->
                <label for="editTongTien" class="mt-2">T·ªïng ti·ªÅn:</label>
                <input id="editTongTien" class="form-control" readonly>

                <!-- Tr·∫°ng th√°i -->
                <label for="editTrangThai" class="mt-2">Tr·∫°ng th√°i:</label>
                <input type="text" id="editTrangThai" class="form-control">

                <!-- Danh s√°ch s·∫£n ph·∫©m -->
                <h5 class="mt-3">Danh s√°ch s·∫£n ph·∫©m</h5>
                <table class="table table-bordered">
                  <thead>
                    <tr>
                      <th>T√™n s·∫£n ph·∫©m</th>
                      <th>S·ªë l∆∞·ª£ng</th>
                      <th>ƒê∆°n gi√°</th>
                      <th>VAT (%)</th>
                      <th>Chi·∫øt kh·∫•u (%)</th>
                      <th>T·ªïng</th>
                      <th>H√†nh ƒë·ªông</th>
                    </tr>
                  </thead>
                  <tbody id="editDanhSachSanPham">
                    <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                  </tbody>
                </table>
                <button type="button" class="btn btn-success btn-sm" onclick="addEditProductRow()">Th√™m s·∫£n
                  ph·∫©m</button>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                  onclick="closeModal('editModal')">ƒê√≥ng</button>
                <button type="button" class="btn btn-primary" onclick="saveChanges()">L∆∞u thay ƒë·ªïi</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Delete Modal -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">X√≥a phi·∫øu</h5>
              </div>
              <div class="modal-body">
                B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a phi·∫øu n√†y kh√¥ng?
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                <button type="button" class="btn btn-danger" id="confirmDelete" onclick="confirmDelete()">X√≥a</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Toast th√¥ng b√°o -->
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
        <div id="saveToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
          aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">
              üü¢ ƒê√£ l∆∞u thay ƒë·ªïi th√†nh c√¥ng!
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      </div>

      <!-- Toast th√¥ng b√°o x√≥a -->
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div id="deleteToast" class="toast align-items-center text-bg-danger border-0" role="alert"
          aria-live="assertive" aria-atomic="true">
          <div class="d-flex">
            <div class="toast-body">
              üî¥ ƒê√£ x√≥a danh m·ª•c th√†nh c√¥ng!
            </div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      </div>

      <!-- Container ƒë·ªÉ ch·ª©a t·∫•t c·∫£ toast -->
      <div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <!-- Toast th√†nh c√¥ng -->
        <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true">
            <div class="d-flex">
                <div class="toast-body" id="successMessage"></div>
            </div>
        </div>

        <!-- Toast l·ªói -->
        <div id="errorToast" class="toast align-items-center text-bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true">
            <div class="d-flex">
                <div class="toast-body" id="errorMessage"></div>
            </div>
        </div>
      </div>


      <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    <footer class="main-footer">
      <strong>Copyright &copy; 2025 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>
      All rights reserved.
      <div class="float-right d-none d-sm-inline-block">
        <b>Version</b> 1.1.0
      </div>
    </footer>

    <!-- Control Sidebar -->
    <aside class="control-sidebar control-sidebar-dark">
      <!-- Control sidebar content goes here -->
    </aside>
    <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->
  <script>
    // Danh s√°ch to√†n c·ª•c
    let productList = [];
    let warehouseList = [];
    let allOrders = []; // L∆∞u danh s√°ch phi·∫øu xu·∫•t

    function showSuccessToast(message) {
        document.getElementById("successMessage").innerText = message;
        var successToast = new bootstrap.Toast(document.getElementById("successToast"));
        successToast.show();
    }

    function showErrorToast(message) {
        document.getElementById("errorMessage").innerText = message;
        var errorToast = new bootstrap.Toast(document.getElementById("errorToast"));
        errorToast.show();
    }

    // H√†m l·∫•y danh s√°ch phi·∫øu xu·∫•t v√† hi·ªÉn th·ªã l√™n b·∫£ng
    async function loadOrders() {
      const token = localStorage.getItem('accessToken') || "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXItaWQiOjEsImV4cCI6MTc0MjkxMjIzOCwiaWF0IjoxNzQxOTEyMjM8fQ.u3o5eOTXJRQVJWCEYG6MZjUP8wtInEJVIDbsLJBUqG4BgYjEHcnO8issQE7_y9wsBFzGscNEAXz6O_BHLC_law";

      if (!token) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
        return;
      }

      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      myHeaders.append("Authorization", `Bearer ${token}`);

      const requestOptions = {
        method: "GET",
        headers: myHeaders,
        redirect: "follow"
      };

      try {
        const response = await fetch("http://localhost:8080/api/orders/getAllOrders", requestOptions);
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`L·ªói: ${response.status} - ${errorText}`);
        }

        const result = await response.json();
        allOrders = result.data; // L∆∞u danh s√°ch
        console.log("Danh s√°ch phi·∫øu xu·∫•t (t·∫•t c·∫£):", allOrders);

        const activeOrders = allOrders.filter(order => order.status === true);
        console.log("Danh s√°ch phi·∫øu xu·∫•t (status = true):", activeOrders);

        displayOrders(activeOrders); // Hi·ªÉn th·ªã ch·ªâ c√°c phi·∫øu c√≥ status = true
      } catch (error) {
        console.error("L·ªói khi l·∫•y danh s√°ch phi·∫øu xu·∫•t:", error);
        showErrorToast(`Kh√¥ng th·ªÉ l·∫•y danh s√°ch phi·∫øu xu·∫•t: ${error.message}`);
      }
    }

    // H√†m hi·ªÉn th·ªã d·ªØ li·ªáu l√™n b·∫£ng
    function displayOrders(orders) {
      const tbody = document.querySelector('.phieu tbody');
      if (!tbody) {
        console.error("Kh√¥ng t√¨m th·∫•y tbody trong b·∫£ng .phieu");
        return;
      }
      tbody.innerHTML = ''; // X√≥a n·ªôi dung c≈©

      orders.forEach((order, index) => {
        const orderTypeText = order.orderType === 1 ? 'Xu·∫•t n·ªôi b·ªô' : order.orderType === 2 ? 'Xu·∫•t ngo√†i' : 'N/A';
        const row = document.createElement('tr');
        row.innerHTML = `
              <td>${index + 1}</td>
              <td>${orderTypeText}</td>
              <td>${order.customer || 'N/A'}</td>
              <td>${order.dskhohang ? order.dskhohang.name : order.khohangId || 'N/A'}</td>
              <td>${order.user ? order.user.username : order.userId || 'N/A'}</td>
              <td>${formatDate(order.createdAt) || 'N/A'}</td>
              <td>${formatCurrency(order.finalAmount) || '0'}</td>
              <td> 
                  <button class="btn btn-primary btn-sm" onclick="openEditModal('${order.orderId}')">
                      <i class="fas fa-pencil-alt"></i> S·ª≠a
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="openDeleteModal('${order.orderId}')">
                      <i class="fas fa-trash"></i> Xo√°
                  </button>
              </td>
          `;
        tbody.appendChild(row);
      });
    }

    // Load s·∫£n ph·∫©m t·ª´ API
    async function loadProducts() {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
        return;
      }

      try {
        const myHeaders = new Headers();
        myHeaders.append('Authorization', `Bearer ${token}`);

        const response = await fetch('http://localhost:8080/api/products', {
          method: 'GET',
          headers: myHeaders
        });

        if (!response.ok) {
          throw new Error('L·ªói khi g·ªçi API: ' + response.status);
        }

        const data = await response.json();
        productList = (data.data?.listProduct || []).filter(item => getProductData(item).status === true);
        console.log('Danh s√°ch s·∫£n ph·∫©m (status = true):', productList);
      } catch (error) {
        console.error('L·ªói khi l·∫•y danh s√°ch s·∫£n ph·∫©m:', error);
        showErrorToast('Kh√¥ng th·ªÉ t·∫£i danh s√°ch s·∫£n ph·∫©m. Vui l√≤ng th·ª≠ l·∫°i.');
      }
    }

    // Chu·∫©n h√≥a d·ªØ li·ªáu s·∫£n ph·∫©m
    function getProductData(item) {
      const isNested = item.product !== undefined;
      return {
        productId: isNested ? item.product.productId : item.productId,
        category: isNested ? item.product.category : item.category,
        productName: isNested ? item.product.productName : item.productName,
        price: isNested ? item.product.price : item.price,
        description: isNested ? item.product.description : item.description,
        status: isNested ? item.product.status : item.status,
        currentStock: isNested ? item.currentStock : undefined
      };
    }

    // Load kho nh·∫≠p h√†ng t·ª´ API
    async function getWarehouses() {
      const token = localStorage.getItem('accessToken');
      if (!token) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
        return;
      }

      const myHeaders = new Headers();
      myHeaders.append('Authorization', `Bearer ${token}`);

      try {
        const response = await fetch('http://localhost:8080/api/dskhohangs', {
          method: 'GET',
          headers: myHeaders
        });

        if (!response.ok) {
          throw new Error(`L·ªói: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        warehouseList = (data.data?.listDskhohang || []).filter(warehouse => warehouse.status === true);
        console.log('Danh s√°ch kho (status = true):', warehouseList);
      } catch (error) {
        console.error('L·ªói khi l·∫•y danh s√°ch kho:', error);
        showErrorToast('Kh√¥ng th·ªÉ t·∫£i danh s√°ch kho, vui l√≤ng th·ª≠ l·∫°i!');
      }
    }

    // Hi·ªÉn th·ªã dropdown s·∫£n ph·∫©m trong modal
    function showEditProductDropdown(inputElement, isFocus = false) {
      const dropdownMenu = inputElement.nextElementSibling;
      const searchText = inputElement.value.toLowerCase();

      const filteredProducts = isFocus
        ? productList
        : productList.filter(product => {
          const productData = getProductData(product);
          return productData.productName.toLowerCase().includes(searchText) && productData.status === true;
        });

      dropdownMenu.innerHTML = '';

      if (filteredProducts.length === 0) {
        dropdownMenu.innerHTML = '<a class="dropdown-item" href="#">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</a>';
      } else {
        filteredProducts.forEach(product => {
          const productData = getProductData(product);
          const item = document.createElement('a');
          item.classList.add('dropdown-item');
          item.href = '#';
          item.textContent = `${productData.productName} - ${productData.price || 0} VND${productData.currentStock !== undefined ? ` (T·ªìn: ${productData.currentStock})` : ''}`;
          item.onclick = () => selectEditProduct(inputElement, productData);
          dropdownMenu.appendChild(item);
        });
      }

      dropdownMenu.classList.add('show');
    }

    // Ch·ªçn s·∫£n ph·∫©m t·ª´ dropdown trong modal
    function selectEditProduct(inputElement, product) {
      const row = inputElement.closest('tr');
      inputElement.value = product.productName;
      inputElement.dataset.productId = product.productId;
      row.querySelector('.price').value = product.price || 0;
      row.querySelector('.dropdown-menu').classList.remove('show');
      calculateEditRowTotal(row.querySelector('.quantity'));
    }

    // Hi·ªÉn th·ªã dropdown kho trong modal
    function showEditWarehouseDropdown(inputElement, isFocus = false) {
      const dropdownMenu = inputElement.nextElementSibling;
      const searchText = inputElement.value.toLowerCase();

      const filteredWarehouses = isFocus
        ? warehouseList
        : warehouseList.filter(warehouse => warehouse.name.toLowerCase().includes(searchText));

      dropdownMenu.innerHTML = '';

      if (filteredWarehouses.length === 0) {
        dropdownMenu.innerHTML = '<a class="dropdown-item" href="#">Kh√¥ng t√¨m th·∫•y kho</a>';
      } else {
        filteredWarehouses.forEach(warehouse => {
          const item = document.createElement('a');
          item.classList.add('dropdown-item');
          item.href = '#';
          item.textContent = warehouse.name;
          item.onclick = () => selectEditWarehouse(inputElement, warehouse);
          dropdownMenu.appendChild(item);
        });
      }

      dropdownMenu.classList.add('show');
    }

    // Ch·ªçn kho t·ª´ dropdown trong modal
    function selectEditWarehouse(inputElement, warehouse) {
      inputElement.value = warehouse.name;
      inputElement.dataset.khohangId = warehouse.khohangId;
      inputElement.nextElementSibling.classList.remove('show');
      console.log('ƒê√£ ch·ªçn kho:', { name: warehouse.name, id: warehouse.khohangId });
    }

    // ·∫®n dropdown khi click ra ngo√†i
    document.addEventListener('click', (event) => {
      const dropdowns = document.querySelectorAll('.dropdown-menu');
      dropdowns.forEach(dropdown => {
        if (!dropdown.parentElement.contains(event.target)) {
          dropdown.classList.remove('show');
        }
      });
    });

    // M·ªü modal ch·ªânh s·ª≠a
    async function openEditModal(orderId) {
      const token = localStorage.getItem('accessToken') || "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXItaWQiOjEsImV4cCI6MTc0MjkxMjIzOCwiaWF0IjoxNzQxOTEyMjM8fQ.u3o5eOTXJRQVJWCEYG6MZjUP8wtInEJVIDbsLJBUqG4BgYjEHcnO8issQE7_y9wsBFzGscNEAXz6O_BHLC_law";

      if (!token) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
        return;
      }

      let order = allOrders.find(o => o.orderId === parseInt(orderId));
      console.log("Phi·∫øu xu·∫•t t·ª´ allOrders:", order); // Log ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu g·ªëc

      if (!order) {
        try {
          const myHeaders = new Headers();
          myHeaders.append("Authorization", `Bearer ${token}`);
          myHeaders.append("Content-Type", "application/json");

          const response = await fetch(`http://localhost:8080/api/orders/${orderId}`, {
            method: "GET",
            headers: myHeaders
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`L·ªói: ${response.status} - ${errorText}`);
          }
          order = await response.json();
          console.log("Phi·∫øu xu·∫•t t·ª´ API:", order); // Log d·ªØ li·ªáu t·ª´ API
        } catch (error) {
          console.error("L·ªói khi l·∫•y chi ti·∫øt phi·∫øu xu·∫•t:", error);
          order = {
            orderId: orderId,
            orderType: 1,
            status: "In progress",
            khohangId: null,
            customer: null,
            address: null,
            totalAmount: 0,
            vat: 0,
            discount: 0,
            finalAmount: 0,
            orderDetails: [],
            user: { username: "N/A" },
            createdAt: new Date().toISOString().split('T')[0]
          };
          showErrorToast(`Phi·∫øu xu·∫•t v·ªõi ID ${orderId} kh√¥ng t·ªìn t·∫°i. Modal s·∫Ω m·ªü v·ªõi d·ªØ li·ªáu m·∫∑c ƒë·ªãnh.`);
        }
      }

      document.getElementById('editOrderType').value = order.orderType || '';
      document.getElementById('editNhaCungCap').value = order.customer || '';
      document.getElementById('editAddress').value = order.address || '';

      // G√°n khohangId v√† t√™n kho
      const warehouse = order.khohangId ? warehouseList.find(w => w.khohangId === order.khohangId) : null;
      document.getElementById('editKhoXuat').value = warehouse ? warehouse.name : order.khohangId ? `Kho ${order.khohangId}` : '';
      document.getElementById('editKhoXuat').dataset.khohangId = order.khohangId || ''; // Gi·ªØ nguy√™n gi√° tr·ªã khohangId g·ªëc
      console.log("Gi√° tr·ªã khohangId khi m·ªü modal:", document.getElementById('editKhoXuat').dataset.khohangId);

      document.getElementById('editNguoiXuat').value = order.user?.username || 'N/A';
      document.getElementById('editNgayXuat').value = order.createdAt ? order.createdAt.split('T')[0] : '';
      document.getElementById('editTongTien').value = formatCurrency(order.finalAmount || 0);
      document.getElementById('editTrangThai').value = order.status || '';

      document.getElementById('editModal').dataset.orderId = orderId;

      const tbody = document.getElementById('editDanhSachSanPham');
      tbody.innerHTML = '';
      (order.orderDetails || []).forEach(detail => {
        addEditProductRow(detail);
      });

      handleEditExportTypeChange();

      const modal = new bootstrap.Modal(document.getElementById('editModal'));
      modal.show();
      console.log("Phi·∫øu xu·∫•t t·ª´ allOrders:", order);
      console.log("Phi·∫øu xu·∫•t t·ª´ API:", order);
    }

    // X·ª≠ l√Ω thay ƒë·ªïi lo·∫°i phi·∫øu trong modal
    function handleEditExportTypeChange() {
      const orderType = document.getElementById('editOrderType').value;
      const warehouseGroup = document.getElementById('editWarehouseGroup');
      const customerGroup = document.getElementById('editCustomerGroup');
      const addressGroup = document.getElementById('editAddressGroup');

      if (orderType === "1") {
        // Xu·∫•t n·ªôi b·ªô: Hi·ªÉn th·ªã kho, ·∫©n kh√°ch h√†ng v√† ƒë·ªãa ch·ªâ
        warehouseGroup.style.display = 'block';
        customerGroup.style.display = 'none';
        addressGroup.style.display = 'none';
      } else if (orderType === "2") {
        // Xu·∫•t ngo√†i: ·∫®n kho, hi·ªÉn th·ªã kh√°ch h√†ng v√† ƒë·ªãa ch·ªâ
        warehouseGroup.style.display = 'none';
        customerGroup.style.display = 'block';
        addressGroup.style.display = 'block';
      }
    }

    // Th√™m d√≤ng s·∫£n ph·∫©m v√†o modal
    function addEditProductRow(detail = {}) {
      const tbody = document.getElementById('editDanhSachSanPham');
      const row = document.createElement('tr');
      row.innerHTML = `
          <td>
              <input type="text" class="form-control product-name" value="${detail.productName || ''}" data-product-id="${detail.productId || ''}" oninput="showEditProductDropdown(this)" onfocus="showEditProductDropdown(this, true)">
              <div class="dropdown-menu"></div>
          </td>
          <td><input type="number" class="form-control quantity" value="${detail.quantity || 0}" oninput="calculateEditRowTotal(this)"></td>
          <td><input type="number" class="form-control price" value="${detail.price || 0}" oninput="calculateEditRowTotal(this)"></td>
          <td><input type="number" class="form-control vat" value="${detail.vat || 0}" oninput="calculateEditRowTotal(this)"></td>
          <td><input type="number" class="form-control discount" value="${detail.discount || 0}" oninput="calculateEditRowTotal(this)"></td>
          <td><input type="text" class="form-control totalAmount" value="${formatCurrency(detail.totalAmount || 0)}" readonly></td>
          <td><button class="btn btn-danger btn-sm" onclick="removeEditProductRow(this)">X√≥a</button></td>
      `;
      tbody.appendChild(row);
    }

    // X√≥a d√≤ng s·∫£n ph·∫©m
    function removeEditProductRow(button) {
      const row = button.closest('tr');
      if (document.getElementById('editDanhSachSanPham').children.length > 1) {
        row.remove();
        updateEditTotal();
      } else {
        showErrorToast('Ph·∫£i c√≥ √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m!');
      }
    }

    // T√≠nh t·ªïng cho t·ª´ng d√≤ng
    function calculateEditRowTotal(element) {
      const row = element.closest('tr');
      const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
      const price = parseFloat(row.querySelector('.price').value) || 0;
      const vat = parseFloat(row.querySelector('.vat').value) || 0;
      const discount = parseFloat(row.querySelector('.discount').value) || 0;

      const subtotal = quantity * price * (1 - discount / 100);
      const totalAmount = subtotal * (1 + vat / 100);
      row.querySelector('.totalAmount').value = formatCurrency(totalAmount);

      updateEditTotal();
    }

    // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn phi·∫øu
    function updateEditTotal() {
      const rows = document.querySelectorAll('#editDanhSachSanPham tr');
      let finalAmount = 0;
      rows.forEach(row => {
        const totalAmount = parseFloat(row.querySelector('.totalAmount').value.replace(/[^0-9.-]+/g, '')) || 0;
        finalAmount += totalAmount;
      });
      document.getElementById('editTongTien').value = formatCurrency(finalAmount);
    }

    // L∆∞u thay ƒë·ªïi
    async function saveChanges() {
      const token = localStorage.getItem('accessToken') || "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXI-taWQiOjEsImV4cCI6MTc0MjkxMjIzOCwiaWF0IjoxNzQxOTEyMjM8fQ.u3o5eOTXJRQVJWCEYG6MZjUP8wtInEJVIDbsLJBUqG4BgYjEHcnO8issQE7_y9wsBFzGscNEAXz6O_BHLC_law";
      if (!token) {
          showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
          return;
      }
  
      const orderType = document.getElementById('editOrderType').value;
      const khohangId = document.getElementById('editKhoXuat').dataset.khohangId;
      const orderId = document.getElementById('editModal').dataset.orderId;
  
      if (!orderId) {
          showErrorToast('Kh√¥ng t√¨m th·∫•y orderId!');
          return;
      }
  
      if (orderType === "1" && (!khohangId || khohangId === '' || isNaN(parseInt(khohangId)))) {
          showErrorToast('Vui l√≤ng ch·ªçn kho xu·∫•t cho phi·∫øu xu·∫•t n·ªôi b·ªô!');
          return;
      }
  
      if (orderType === "2") {
          const customer = document.getElementById('editNhaCungCap').value;
          const address = document.getElementById('editAddress').value;
          if (!customer || !address) {
              showErrorToast('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin kh√°ch h√†ng v√† ƒë·ªãa ch·ªâ cho phi·∫øu xu·∫•t ngo√†i!');
              return;
          }
      }
  
      const rows = document.querySelectorAll('#editDanhSachSanPham tr');
      const orderDetails = Array.from(rows).map(row => {
          const quantity = parseFloat(row.querySelector('.quantity').value) || 0;
          const price = parseFloat(row.querySelector('.price').value) || 0;
          const discount = parseFloat(row.querySelector('.discount').value) || 0;
          const subtotal = quantity * price * (1 - discount / 100);
          const productId = parseInt(row.querySelector('.product-name').dataset.productId);
  
          if (!productId) {
              showErrorToast('Vui l√≤ng ch·ªçn s·∫£n ph·∫©m h·ª£p l·ªá!');
              return null;
          }
  
          return {
              productId: productId,
              quantity: quantity || 0,
              subtotal: subtotal || 0,
              vat: parseFloat(row.querySelector('.vat').value) || 0,
              discount: discount || 0,
              totalAmount: parseFloat(row.querySelector('.totalAmount').value.replace(/[^0-9.-]+/g, '')) || 0
          };
      }).filter(detail => detail !== null);
  
      if (orderDetails.length === 0) {
          showErrorToast('Danh s√°ch s·∫£n ph·∫©m kh√¥ng h·ª£p l·ªá!');
          return;
      }
  
      const finalAmount = parseFloat(document.getElementById('editTongTien').value.replace(/[^0-9.-]+/g, '')) || 0;
  
      // L·∫•y userId t·ª´ d·ªØ li·ªáu g·ªëc trong openEditModal
      let order = allOrders.find(o => o.orderId === parseInt(orderId));
      const userId = order && order.user ? order.user.userId : 1; // M·∫∑c ƒë·ªãnh l√† 1 n·∫øu kh√¥ng l·∫•y ƒë∆∞·ª£c
  
      const updatedOrder = {
          orderType: parseInt(orderType),
          status: document.getElementById('editTrangThai').value || "In progress",
          khohangId: khohangId ? parseInt(khohangId) : null,
          customer: document.getElementById('editNhaCungCap').value || null,
          address: document.getElementById('editAddress').value || null,
          totalAmount: finalAmount,
          vat: orderDetails.length > 0 ? orderDetails[0].vat : 0,
          discount: orderDetails.length > 0 ? orderDetails[0].discount : 0,
          finalAmount: finalAmount,
          orderDetails: orderDetails,
          userId: userId // Th√™m userId
      };
  
      console.log("D·ªØ li·ªáu g·ª≠i ƒëi:", JSON.stringify(updatedOrder, null, 2));
  
      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      myHeaders.append("Authorization", `Bearer ${token}`);
  
      const requestOptions = {
          method: "PUT",
          headers: myHeaders,
          body: JSON.stringify(updatedOrder),
          redirect: "follow"
      };
  
      try {
          const response = await fetch(`http://localhost:8080/api/orders/update/${orderId}`, requestOptions);
          const result = await response.text();
          if (response.ok) {
              showSuccessToast("C·∫≠p nh·∫≠t phi·∫øu xu·∫•t th√†nh c√¥ng!");
              const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
              modal.hide();
              loadOrders();
          } else {
              throw new Error(`L·ªói: ${response.status} - ${result}`);
          }
      } catch (error) {
          console.error("L·ªói khi c·∫≠p nh·∫≠t phi·∫øu:", error);
          showErrorToast("ƒê√£ c√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t phi·∫øu xu·∫•t: " + error.message);
      }
  }

    function openDeleteModal(orderId) {
      document.getElementById('deleteModal').dataset.orderId = orderId;
      const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
      modal.show();
    }

    // X√°c nh·∫≠n x√≥a phi·∫øu xu·∫•t
    async function confirmDelete() {
      const token = localStorage.getItem('accessToken') || "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsInVzZXItaWQiOjEsImV4cCI6MTc0MjkxMjIzOCwiaWF0IjoxNzQxOTEyMjM4fQ.u3o5eOTXJRQVJWCEYG6MZjUP8wtInEJVIDbsLJBUqG4BgYjEHcnO8issQE7_y9wsBFzGscNEAXz6O_BHLC_law";
      if (!token) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y token. Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.');
        return;
      }
    
      const orderId = document.getElementById('deleteModal').dataset.orderId;
      if (!orderId) {
        showErrorToast('Kh√¥ng t√¨m th·∫•y orderId ƒë·ªÉ x√≥a!');
        return;
      }
    
      const myHeaders = new Headers();
      myHeaders.append("Content-Type", "application/json");
      myHeaders.append("Authorization", `Bearer ${token}`);
    
      // T·∫°o d·ªØ li·ªáu g·ª≠i ƒëi d∆∞·ªõi d·∫°ng {"ids": [orderId]}
      const raw = JSON.stringify({
        "ids": [parseInt(orderId)]
      });
    
      const requestOptions = {
        method: "DELETE",
        headers: myHeaders,
        body: raw,
        redirect: "follow"
      };
    
      try {
        const response = await fetch("http://localhost:8080/api/orders/delete", requestOptions);
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`L·ªói: ${response.status} - ${errorText}`);
        }
    
        const result = await response.text();
        console.log("K·∫øt qu·∫£ x√≥a:", result);
        showErrorToast(`ƒê√£ x√≥a phi·∫øu xu·∫•t v·ªõi ID ${orderId} th√†nh c√¥ng!`);
        const modal = bootstrap.Modal.getInstance(document.getElementById('deleteModal'));
        modal.hide();
        loadOrders();
      } catch (error) {
        console.error("L·ªói khi x√≥a phi·∫øu xu·∫•t:", error);
        showErrorToast("ƒê√£ c√≥ l·ªói x·∫£y ra khi x√≥a phi·∫øu xu·∫•t: " + error.message);
      }
    }

    // ƒê√≥ng modal
    function closeModal(modalId) {
      const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
      modal.hide();
    }

    // H√†m ƒë·ªãnh d·∫°ng ng√†y
    function formatDate(dateString) {
      if (!dateString) return 'N/A';
      const date = new Date(dateString);
      return date.toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });
    }

    // H√†m ƒë·ªãnh d·∫°ng ti·ªÅn t·ªá
    function formatCurrency(amount) {
      const parsedAmount = parseFloat(amount);
      if (isNaN(parsedAmount) || amount == null) {
        return '0,00 ƒë';
      }
      return parsedAmount.toLocaleString('vi-VN', {
        style: 'currency',
        currency: 'VND',
        minimumFractionDigits: 2,
        maximumFractionDigits: 6
      });
    }

    // G·ªçi c√°c h√†m khi trang t·∫£i
    document.addEventListener('DOMContentLoaded', () => {
      loadProducts();
      getWarehouses();
      loadOrders();
    });

    document.getElementById("filterStartDate").addEventListener("change", filterOrders);
    document.getElementById("filterEndDate").addEventListener("change", filterOrders);
    document.getElementById("filterCustomer").addEventListener("input", filterOrders);

    let ordersData = []; // L∆∞u tr·ªØ d·ªØ li·ªáu ban ƒë·∫ßu

    // H√†m g·ªçi API l·∫•y danh s√°ch phi·∫øu xu·∫•t
    async function fetchOrders() {
        const token = localStorage.getItem("accessToken");
        if (!token) {
            console.error("Kh√¥ng t√¨m th·∫•y token! Vui l√≤ng ƒëƒÉng nh·∫≠p.");
            return;
        }

        // L·∫•y gi√° tr·ªã filter
        const startDate = document.getElementById("filterStartDate").value;
        const endDate = document.getElementById("filterEndDate").value;
        const customerName = document.getElementById("filterCustomer").value.trim();

        // T·∫°o URL query string
        const params = new URLSearchParams();
        if (startDate) params.append("fromDate", startDate);
        if (endDate) params.append("toDate", endDate);
        if (customerName) params.append("customer", customerName);

        const apiUrl = `http://localhost:8080/api/orders/search?${params.toString()}`;

        try {
            const response = await fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Authorization": `Bearer ${token}`,
                    "Content-Type": "application/json"
                }
            });

            if (!response.ok) {
                throw new Error(`L·ªói API: ${response.status}`);
            }

            const data = await response.json();
            ordersData = data.data || []; // G√°n danh s√°ch phi·∫øu xu·∫•t
            renderOrders(ordersData);
        } catch (error) {
            console.error("L·ªói khi g·ªçi API:", error);
        }
    }

    function getOrderTypeName(orderType) {
      const orderTypes = {
          1: "Xu·∫•t n·ªôi b·ªô",
          2: "Xu·∫•t ngo√†i"          
    }
      return orderTypes[orderType] || "N/A";
    }


    // H√†m hi·ªÉn th·ªã danh s√°ch phi·∫øu xu·∫•t l√™n b·∫£ng
    function renderOrders(orders) {
        const tableBody = document.getElementById("orderList");
        tableBody.innerHTML = "";

        if (!orders || orders.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="7" class="text-center">Kh√¥ng t√¨m th·∫•y phi·∫øu xu·∫•t</td></tr>`;
            return;
        }

        orders.forEach((order, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td class="text-left">${index + 1}</td>
                <td class="text-left">${getOrderTypeName(order.orderType)}</td>
                <td class="text-left">${order.customer}</td>
                <td class="text-left">${order.dskhohang?.name || "N/A"}</td>
                <td class="text-left">${order.user?.username || "N/A"}</td>
                <td class="text-left">${order.createdAt.split("T")[0]}</td>
                <td class="text-left">${order.totalAmount.toLocaleString()} VND</td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="openEditModal('${order.orderId}')">
                      <i class="fas fa-edit"></i> Edit
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="openDeleteModal('${order.orderId}')">
                      <i class="fas fa-trash"></i> Delete
                  </button>
                </td>
            `;
            tableBody.appendChild(row);
        });
    }

    // H√†m l·ªçc danh s√°ch phi·∫øu xu·∫•t
    function filterOrders() {
        const startDate = document.getElementById("filterStartDate").value;
        const endDate = document.getElementById("filterEndDate").value;
        const customerName = document.getElementById("filterCustomer").value.toLowerCase();

        if (!startDate && !endDate && !customerName) {
            fetchOrders(); // G·ªçi API l·∫°i ƒë·ªÉ l·∫•y d·ªØ li·ªáu g·ªëc
            return;
        }

        const filteredOrders = ordersData.filter(order => {
            const orderDate = order.createdAt.split("T")[0]; // L·∫•y ng√†y t·ª´ timestamp
            const customer = order.customer?.toLowerCase() || "";

            return (
                (!startDate || orderDate >= startDate) &&
                (!endDate || orderDate <= endDate) &&
                (!customerName || customer.includes(customerName))
            );
        });

        renderOrders(filteredOrders);
    }


    // G·ªçi API khi t·∫£i trang
    fetchOrders();

</script>

  <!-- jQuery -->
  <script src="../../../plugins/jquery/jquery.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="../../../plugins/jquery-ui/jquery-ui.min.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button)
  </script>
  <!-- Bootstrap 4 -->
  <script src="../../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- ChartJS -->
  <script src="../../../plugins/chart.js/Chart.min.js"></script>
  <!-- Sparkline -->
  <script src="../../../plugins/sparklines/sparkline.js"></script>
  <!-- JQVMap -->
  <script src="../../../plugins/jqvmap/jquery.vmap.min.js"></script>
  <script src="../../../plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="../../../plugins/jquery-knob/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="../../../plugins/moment/moment.min.js"></script>
  <script src="../../../plugins/daterangepicker/daterangepicker.js"></script>
  <!-- Tempusdominus Bootstrap 4 -->
  <script src="../../../plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>
  <!-- Summernote -->
  <script src="../../../plugins/summernote/summernote-bs4.min.js"></script>
  <!-- overlayScrollbars -->
  <script src="../../../plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
  <!-- AdminLTE App -->
  <script src="../../../dist/js/adminlte.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="../../../dist/js/demo.js"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <script src="../../../dist/js/pages/dashboard.js"></script>
  <!-- Bootstrap 5 JavaScript -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>